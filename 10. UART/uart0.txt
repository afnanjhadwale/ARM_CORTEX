#include"uart0_header.h"


void uart0_init(void)
{
	LPC_SC->PCONP |=  (1<<3);			//turn on UART
	LPC_SC->PCLKSEL0 &= ~(0x03 <<6);	//pclk = cllk/4

	LPC_PINCON->PINSEL0 |= UART;		//P0.2 as TXD0 and P0.3 as RXD0

	UART0->LCR |= (1<<7);
	UART0->DLL = 6;
	UART0->DLM = 0;
	UART0->FDR |= (12 << 4) | (0x01);  //Mul = 12, Div  = 1

	/*
	Calculating Baud Rate
		Buad Rate = PCLK / (16*( (256 * DLM) + DLL)) * (1 + DivAddVal/MulVal))
		
		PCLK = 1MHz
		Desired Baud rate  = 9600
		DivAddVal = 1
		MulVal = 12

		DLL and DLM = ?

		((256*DLM) + DLL)	= PCLK / 16 * (Baud Rate	* (1+ DivAddVal/MulVal))

		((256*DLM) + DLL) = 6
		if	DLM = 0
		DLL = 6
		
		So if we set 
		DLL = 6
		DLM = 0
		DivAddVal = 1
		MulVal = 12

		We will achieve the desired baud rate of 9600

	*/

	UART0->LCR &= ~(1<<7);

	UART0->LCR |= (0x03); //data length = 8bit
	UART0->LCR &= ~(1<<2);	//stop bit = 1bit
	UART0->LCR &= ~(1<<3); //no parity
}

void uart0_ch_transmit(char ch)
{

	UART0->THR	= ch;
	while((UART0->LSR & (1<<5)) == 0);
}


void uart0_str_transmit(char *str)
{
	int i = 0;
 	while(str[i] != '\0')
	{
		uart0_ch_transmit(str[i]);
		i++;
	}
}
		

char uart0_ch_recieve(void)
{
	char ch;
	while((UART0->LSR & (1<<0)) == 0);
	ch = UART0->RBR;  
	return ch;
}
   
void delay_ms(uint32_t millis)
{
uint32_t  i , j;
for(i = 0 ; i < millis ; i++)
{
for(j = 0 ; j < 1200 ; j++){ }

}
}  
